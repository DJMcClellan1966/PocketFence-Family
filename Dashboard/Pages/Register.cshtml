@page
@model RegisterModel
@{
    ViewData["Title"] = "Create Account";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"] - PocketFence</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .register-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 2.5rem;
            max-width: 500px;
            width: 100%;
        }
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px;
            font-weight: 600;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        .password-strength {
            height: 4px;
            border-radius: 2px;
            background: #e0e0e0;
            margin-top: 5px;
            overflow: hidden;
        }
        .password-strength-bar {
            height: 100%;
            width: 0%;
            transition: all 0.3s ease;
        }
        .strength-weak { background: #f44336; width: 33%; }
        .strength-medium { background: #ff9800; width: 66%; }
        .strength-strong { background: #4caf50; width: 100%; }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12">
                <div class="register-card mx-auto">
                    <div class="text-center mb-4">
                        <h2 class="fw-bold"><i class="bi bi-shield-fill-check text-primary"></i> Create Account</h2>
                        <p class="text-muted">Join PocketFence to protect your family</p>
                    </div>

                    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
                    {
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            @Model.ErrorMessage
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    }

                    @if (!string.IsNullOrEmpty(Model.SuccessMessage))
                    {
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            @Model.SuccessMessage
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    }

                    <form method="post" id="registerForm">
                        @Html.AntiForgeryToken()

                        <div class="mb-3">
                            <label for="username" class="form-label fw-semibold">
                                <i class="bi bi-person-fill"></i> Username
                            </label>
                            <input type="text" 
                                   class="form-control" 
                                   id="username" 
                                   name="username" 
                                   required 
                                   minlength="3"
                                   maxlength="50"
                                   placeholder="Choose a username"
                                   autocomplete="username">
                            <div class="form-text">At least 3 characters</div>
                        </div>

                        <div class="mb-3">
                            <label for="email" class="form-label fw-semibold">
                                <i class="bi bi-envelope-fill"></i> Email Address
                            </label>
                            <input type="email" 
                                   class="form-control" 
                                   id="email" 
                                   name="email" 
                                   required
                                   maxlength="254"
                                   placeholder="parent@example.com"
                                   autocomplete="email">
                            <div class="form-text">We'll send a verification email</div>
                        </div>

                        <div class="mb-3">
                            <label for="role" class="form-label fw-semibold">
                                <i class="bi bi-person-badge-fill"></i> Account Type
                            </label>
                            <select class="form-select" id="role" name="role" required>
                                <option value="">Select account type...</option>
                                <option value="Parent">Parent/Guardian</option>
                                <option value="Child">Child</option>
                            </select>
                            <div class="form-text">Parents can manage settings and view all activity. Children have limited access.</div>
                        </div>

                        <div class="mb-3">
                            <label for="password" class="form-label fw-semibold">
                                <i class="bi bi-lock-fill"></i> Password
                            </label>
                            <input type="password" 
                                   class="form-control" 
                                   id="password" 
                                   name="password" 
                                   required
                                   minlength="8"
                                   maxlength="128"
                                   placeholder="Create a strong password"
                                   autocomplete="new-password">
                            <div class="password-strength">
                                <div class="password-strength-bar" id="strengthBar"></div>
                            </div>
                            <div class="form-text" id="strengthText">At least 8 characters</div>
                        </div>

                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label fw-semibold">
                                <i class="bi bi-lock-fill"></i> Confirm Password
                            </label>
                            <input type="password" 
                                   class="form-control" 
                                   id="confirmPassword" 
                                   name="confirmPassword" 
                                   required
                                   minlength="8"
                                   maxlength="128"
                                   placeholder="Re-enter your password"
                                   autocomplete="new-password">
                        </div>

                        <!-- Phone verification disabled - email-only verification required
                             To re-enable: uncomment this section and add phone check back to Login.cshtml.cs
                             Configure SMS provider in DashboardService.cs (Twilio recommended) -->
                        <!--
                        <div class="mb-3">
                            <label for="phoneNumber" class="form-label fw-semibold">
                                <i class="bi bi-phone-fill"></i> Phone Number <span class="text-muted">(Optional)</span>
                            </label>
                            <div class="input-group">
                                <select class="form-select" id="countryCode" name="countryCode" style="max-width: 150px;">
                                    <option value="+1" selected>ðŸ‡ºðŸ‡¸ +1 (US)</option>
                                    <option value="+1">ðŸ‡¨ðŸ‡¦ +1 (CA)</option>
                                    <option value="+44">ðŸ‡¬ðŸ‡§ +44 (UK)</option>
                                    <option value="+61">ðŸ‡¦ðŸ‡º +61 (AU)</option>
                                    <option value="+49">ðŸ‡©ðŸ‡ª +49 (DE)</option>
                                    <option value="+33">ðŸ‡«ðŸ‡· +33 (FR)</option>
                                    <option value="+39">ðŸ‡®ðŸ‡¹ +39 (IT)</option>
                                    <option value="+34">ðŸ‡ªðŸ‡¸ +34 (ES)</option>
                                    <option value="+81">ðŸ‡¯ðŸ‡µ +81 (JP)</option>
                                    <option value="+86">ðŸ‡¨ðŸ‡³ +86 (CN)</option>
                                    <option value="+82">ðŸ‡°ðŸ‡· +82 (KR)</option>
                                    <option value="+91">ðŸ‡®ðŸ‡³ +91 (IN)</option>
                                    <option value="+52">ðŸ‡²ðŸ‡½ +52 (MX)</option>
                                    <option value="+55">ðŸ‡§ðŸ‡· +55 (BR)</option>
                                    <option value="+7">ðŸ‡·ðŸ‡º +7 (RU)</option>
                                    <option value="+27">ðŸ‡¿ðŸ‡¦ +27 (ZA)</option>
                                    <option value="+64">ðŸ‡³ðŸ‡¿ +64 (NZ)</option>
                                    <option value="+31">ðŸ‡³ðŸ‡± +31 (NL)</option>
                                    <option value="+46">ðŸ‡¸ðŸ‡ª +46 (SE)</option>
                                    <option value="+47">ðŸ‡³ðŸ‡´ +47 (NO)</option>
                                    <option value="+45">ðŸ‡©ðŸ‡° +45 (DK)</option>
                                    <option value="+358">ðŸ‡«ðŸ‡® +358 (FI)</option>
                                    <option value="+41">ðŸ‡¨ðŸ‡­ +41 (CH)</option>
                                    <option value="+43">ðŸ‡¦ðŸ‡¹ +43 (AT)</option>
                                    <option value="+32">ðŸ‡§ðŸ‡ª +32 (BE)</option>
                                    <option value="+351">ðŸ‡µðŸ‡¹ +351 (PT)</option>
                                    <option value="+30">ðŸ‡¬ðŸ‡· +30 (GR)</option>
                                    <option value="+48">ðŸ‡µðŸ‡± +48 (PL)</option>
                                    <option value="+420">ðŸ‡¨ðŸ‡¿ +420 (CZ)</option>
                                    <option value="+36">ðŸ‡­ðŸ‡º +36 (HU)</option>
                                    <option value="+353">ðŸ‡®ðŸ‡ª +353 (IE)</option>
                                    <option value="+972">ðŸ‡®ðŸ‡± +972 (IL)</option>
                                    <option value="+971">ðŸ‡¦ðŸ‡ª +971 (AE)</option>
                                    <option value="+966">ðŸ‡¸ðŸ‡¦ +966 (SA)</option>
                                    <option value="+65">ðŸ‡¸ðŸ‡¬ +65 (SG)</option>
                                    <option value="+60">ðŸ‡²ðŸ‡¾ +60 (MY)</option>
                                    <option value="+63">ðŸ‡µðŸ‡­ +63 (PH)</option>
                                    <option value="+66">ðŸ‡¹ðŸ‡­ +66 (TH)</option>
                                    <option value="+84">ðŸ‡»ðŸ‡³ +84 (VN)</option>
                                    <option value="+62">ðŸ‡®ðŸ‡© +62 (ID)</option>
                                </select>
                                <input type="tel" 
                                       class="form-control" 
                                       id="phoneNumber" 
                                       name="phoneNumber" 
                                       placeholder="555-123-4567"
                                       autocomplete="tel">
                            </div>
                            <div class="mb-2 mt-2" id="carrierSection" style="display: none;">
                                <label for="carrier" class="form-label fw-semibold text-muted small">
                                    <i class="bi bi-broadcast"></i> Mobile Carrier (for SMS)
                                </label>
                                <select class="form-select" id="carrier" name="carrier">
                                    <option value="">All carriers (may cause bounce emails)</option>
                                    <option value="att">AT&T</option>
                                    <option value="tmobile">T-Mobile</option>
                                    <option value="verizon">Verizon</option>
                                    <option value="sprint">Sprint</option>
                                    <option value="boost">Boost Mobile</option>
                                    <option value="cricket">Cricket Wireless</option>
                                    <option value="uscellular">US Cellular</option>
                                    <option value="virgin">Virgin Mobile</option>
                                    <option value="metropcs">MetroPCS</option>
                                </select>
                                <div class="form-text">Select your carrier to avoid bounce emails</div>
                            </div>
                            <div class="form-text">For account recovery and SMS verification</div>
                        </div>
                        -->

                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="agreeTerms" required>
                            <label class="form-check-label" for="agreeTerms">
                                I agree to the <a href="#" class="text-decoration-none">Terms of Service</a> and <a href="#" class="text-decoration-none">Privacy Policy</a>
                            </label>
                        </div>

                        <button type="submit" class="btn btn-primary w-100" id="registerBtn">
                            <span class="btn-text">Create Account</span>
                            <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                        </button>

                        <div class="text-center mt-3">
                            <a href="/login" class="text-decoration-none">Already have an account? Sign in</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Password strength checker
        document.getElementById('password').addEventListener('input', function() {
            const password = this.value;
            const strengthBar = document.getElementById('strengthBar');
            const strengthText = document.getElementById('strengthText');
            
            let strength = 0;
            if (password.length >= 8) strength++;
            if (password.match(/[a-z]/)) strength++;
            if (password.match(/[A-Z]/)) strength++;
            if (password.match(/[0-9]/)) strength++;
            if (password.match(/[^a-zA-Z0-9]/)) strength++;
            
            strengthBar.className = 'password-strength-bar';
            if (strength <= 2) {
                strengthBar.classList.add('strength-weak');
                strengthText.textContent = 'âš ï¸ Weak password';
                strengthText.className = 'form-text text-danger';
            } else if (strength <= 4) {
                strengthBar.classList.add('strength-medium');
                strengthText.textContent = 'âœ“ Medium strength';
                strengthText.className = 'form-text text-warning';
            } else {
                strengthBar.classList.add('strength-strong');
                strengthText.textContent = 'âœ“ Strong password!';
                strengthText.className = 'form-text text-success';
            }
        });

        // Form submission
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                e.preventDefault();
                alert('âŒ Passwords do not match!');
                return false;
            }
            
            const btn = document.getElementById('registerBtn');
            btn.querySelector('.btn-text').classList.add('d-none');
            btn.querySelector('.spinner-border').classList.remove('d-none');
            btn.disabled = true;
        });

        // Phone verification JavaScript disabled - uncomment if re-enabling phone verification
        /*
        document.getElementById('phoneNumber').addEventListener('input', function() {
            const carrierSection = document.getElementById('carrierSection');
            if (this.value.trim().length > 0) {
                carrierSection.style.display = 'block';
            } else {
                carrierSection.style.display = 'none';
            }
        */
        });
    </script>
</body>
</html>
